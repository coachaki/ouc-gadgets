<!DOCTYPE html>
<html>
<head>
    <!-- This title is not used. -->
    <title>Responsive Image</title> 
    
    <style type="text/css">
        body {
            margin: 10px;
            background-color: transparent;
        }
    </style>

    <!-- jQuery IS REQUIRED for gadgetlib.js to work. -->
    <script type="text/javascript" src="../lib/jquery-3.3.1.min.js"></script>

    <!-- 
        gadgetlib.js is a library of basic functions that gadgets can use. It creates a global
        `gadget` object that has a few useful methods. (See comments in gadgetlib.js.)
    -->
    <script type="text/javascript" src="../lib/gadgetlib.min.js"></script>
    
</head>
<body>
    <div id="main">
        <input name="images" id="images" type="file" multiple style="width:500px;height:200px;"/>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
            gadget.ready().then(gadget.fetch).then(function () {
                $('#main').css({ 'font-size': gadget.getConfig('font_size') });
            });

            $(gadget).on({
                'expanded': function (evt) {
                    // This event is triggered when the user expands (makes visible) a sidebar gadget.
                    console.log('Gadget expanded.');
                },
                'collapsed': function (evt) {
                    // This event is triggered when the user collapses (hides) a sidebar gadget.
                    console.log('Gadget collapsed.');
                },
                'configuration': function (evt, config) {
                    // If the user changes the gadget's configuration through the configuration modal,
                    // the gadget will hear about it and get the new config in the data argument here.
                    console.log('New config:', config);
                    $('#main').css({ 'font-size': config.font_size });
                },
                'notification': function (evt, notification) {
                    // If the gadget's config.xml contains a "notification" entry, any notifications
                    // of the specified type(s) generated by OU Campus will trigger 'notification'
                    // events that can be handled here.
                    console.log('Notification received:', notification);
                }
            });
        });

        $(document).ready(function() {
            $("#images").change(function(e){
                let files = this.files;
                for(let i = 0; i < files.length; i++) {
                    let file = files[i];
                    console.log(file);
                    if (file.type.match(/image\/.*/)) {
                        let filetype = file.type;
                        let img = document.createElement("img");
                        img.src = window.URL.createObjectURL(file);
                        img.onload = function() {
                            let imageWidth = img.width;
                            let imageHeight = img.height;

                            let myCanvas = document.createElement("canvas");
                            myCanvas.width = imageWidth;
                            myCanvas.height = imageHeight;
                            let ctx = myCanvas.getContext("2d");
                            ctx.drawImage(img, 0, 0);
                            console.log(ctx);

                            let dataurl = myCanvas.toDataURL(filetype);
                            let img2 = document.createElement("img");
                            img2.src = dataurl;
                            $("#main").append(img2);
                        };
                    }
                }
            });
        });
    </script>
</body>
</html>
